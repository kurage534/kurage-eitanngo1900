<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ランキング</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">

  <style>
    input, button {
      width: 90%;
      padding: 14px;
      font-size: 1.2rem;
      margin: 6px 0;
    }
    #list div {
      background: #f4f4f4;
      margin: 8px 0;
      padding: 12px;
      border-radius: 8px;
      font-size: 1.1rem;
    }
  </style>
</head>
<body>

<h1>ランキング</h1>

<input id="name" placeholder="名前を入力">
<button id="send">ランキング登録</button>

<p id="msg"></p>

<hr>

<h2>上位10位</h2>
<div id="list">読み込み中...</div>

<br>
<a href="index.html">← ホームへ戻る</a>

<script>
const msg = document.getElementById("msg");

// ランキング取得
async function loadRanking() {
  try {
    const res = await fetch("/api/ranking");
    const data = await res.json();

    if (!data.length) {
      document.getElementById("list").textContent = "まだ登録がありません";
      return;
    }

    document.getElementById("list").innerHTML =
      data.map((r, i) => `
        <div>
          ${i+1}位<br>
          名前：${r.name}<br>
          スコア：${r.score} 点<br>
          時間：${r.time ?? "?"} 秒
        </div>
      `).join("");
  } catch {
    document.getElementById("list").textContent = "読み込みに失敗しました";
  }
}
loadRanking();

// ランキング登録
document.getElementById("send").addEventListener("click", async () => {
  const name = document.getElementById("name").value.trim();
  const score = Number(localStorage.getItem("score"));
  const time = Number(localStorage.getItem("time"));

  if (!name) {
    msg.textContent = "名前を入力してください";
    msg.style.color = "red";
    return;
  }

  const res = await fetch("/api/submit", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ name, score, time })
  });

  const result = await res.json();

  if (result.result === "ok") {
    msg.textContent = "登録しました！";
    msg.style.color = "green";
    loadRanking();
  } else if (result.result === "duplicate") {
    msg.textContent = "同じ記録は登録済みです";
    msg.style.color = "red";
  } else {
    msg.textContent = "登録に失敗しました";
    msg.style.color = "red";
  }
});
</script>

</body>
</html>
