<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒ©ãƒ³ã‚­ãƒ³ã‚°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h1>

<!-- è‡ªåˆ†ã®é †ä½ -->
<div id="my-rank" style="display:none; margin-bottom:15px;"></div>

<!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¸€è¦§ -->
<ul id="ranking-list" style="list-style:none; padding:0;">
  <li>èª­ã¿è¾¼ã¿ä¸­...</li>
</ul>

<a href="game.html">â† ã‚²ãƒ¼ãƒ ã«æˆ»ã‚‹</a>

<script>
/* =========================
   ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
========================= */
async function loadRanking() {
  const list = document.getElementById("ranking-list");
  list.innerHTML = "<li>èª­ã¿è¾¼ã¿ä¸­...</li>";

  try {
    const res = await fetch("/api/ranking");
    if (!res.ok) throw new Error();

    const data = await res.json();
    list.innerHTML = "";

    if (!data.length) {
      list.innerHTML = "<li>ã¾ã ç™»éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</li>";
      return;
    }

    data.forEach((r, i) => {
      const li = document.createElement("li");
      li.style.background = "#f1f1f1";
      li.style.margin = "8px 0";
      li.style.padding = "12px";
      li.style.borderRadius = "10px";

      li.textContent =
        `${i + 1}ä½ã€€${r.name}ã€€${r.score}ç‚¹ã€€${r.time ?? "-"}ç§’`;

      list.appendChild(li);
    });
  } catch (e) {
    console.error(e);
    list.innerHTML = "<li>ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</li>";
  }
}

/* =========================
   è‡ªåˆ†ã®é †ä½è¡¨ç¤ºï¼ˆå¤±æ•—ã—ã¦ã‚‚OKï¼‰
========================= */
async function loadMyRank() {
  const name = localStorage.getItem("playerName");
  const score = localStorage.getItem("score");
  const time = localStorage.getItem("time");

  if (!name || !score) return;

  try {
    const res = await fetch(
      `/api/my-rank?name=${encodeURIComponent(name)}&score=${score}&time=${time}`
    );
    if (!res.ok) return;

    const data = await res.json();

    const box = document.getElementById("my-rank");
    box.style.display = "block";
    box.style.background = "#e8f3ff";
    box.style.padding = "12px";
    box.style.borderRadius = "12px";
    box.style.textAlign = "center";
    box.style.fontSize = "1.2rem";
    box.textContent = `ğŸ‰ ã‚ãªãŸã®é †ä½ï¼š${data.rank} ä½`;
  } catch {
    // ä½•ã‚‚ã—ãªã„ï¼ˆãƒ©ãƒ³ã‚­ãƒ³ã‚°ã¯æ­£å¸¸è¡¨ç¤ºã•ã‚Œã‚‹ï¼‰
  }
}

/* åˆæœŸå®Ÿè¡Œ */
loadRanking();
loadMyRank();
</script>

</body>
</html>
