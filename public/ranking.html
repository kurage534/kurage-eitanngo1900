<!DOCTYPE html>
<html lang="ja">
<head><meta charset="UTF-8"><title>ランキング</title></head>
<body>

<h1>ランキング</h1>

<input id="name" placeholder="名前">
<button id="send">登録</button>
<div id="msg"></div>
<div id="my-rank"></div>
<div id="list"></div>

<script>
async function load(){
  const r=await fetch("/api/ranking");
  const d=await r.json();
  document.getElementById("list").innerHTML=d.map((x,i)=>`${i+1}位 ${x.name} ${x.score}点 ${x.time}s`).join("<br>");
}
load();

document.getElementById("send").onclick=async()=>{
  if(localStorage.getItem("CAN_REGISTER")!=="YES")return;
  const name=document.getElementById("name").value;
  const score=+localStorage.getItem("score");
  const time=+localStorage.getItem("time");

  const r=await fetch("/api/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name,score,time})});
  const res=await r.json();

  const mr=await fetch("/api/my-rank",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({score,time})});
  const rank=await mr.json();
  document.getElementById("my-rank").textContent=`あなたの順位：${rank.rank}位`;
  localStorage.setItem("CAN_REGISTER","NO");
  load();
};
</script>
</body>
</html>
